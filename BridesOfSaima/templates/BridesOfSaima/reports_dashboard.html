{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - Brides of Saima</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'BridesOfSaima/css/style.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;600;700&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #f8f4f0 0%, #fff 50%, #f9f6f2 100%);
            min-height: 100vh;
        }
        
        .reports-header {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(0, 0, 0, 0.6) 50%, rgba(212, 175, 55, 0.1) 100%),
                        url('{% static "BridesOfSaima/images/Bride1.jpg" %}');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 100px 0 50px 0;
            text-align: center;
        }
        
        .reports-title {
            font-family: 'Dancing Script', cursive;
            font-size: 3rem;
            color: #d4af37;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .stats-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(212, 175, 55, 0.2);
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            border-color: #d4af37;
        }
        
        .stats-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .stats-value {
            font-size: 2rem;
            font-weight: bold;
            color: #d4af37;
            margin-bottom: 0.5rem;
        }
        
        .stats-label {
            color: #666;
            font-size: 1rem;
        }
        
        .filter-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }
        
        .chart-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }
        
        .invoice-table {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }
        
        .table th {
            background: linear-gradient(45deg, #d4af37, #f4e4a6);
            color: white;
            border: none;
            font-weight: 600;
        }
        
        .btn-filter {
            background: linear-gradient(45deg, #d4af37, #f4e4a6);
            border: none;
            color: white;
            font-weight: 600;
            border-radius: 25px;
            padding: 10px 25px;
            transition: all 0.3s ease;
        }
        
        .btn-filter:hover {
            background: linear-gradient(45deg, #b8941f, #d4af37);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
            color: white;
        }
        
        .payment-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-paid {
            background: #d4edda;
            color: #155724;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-partial {
            background: #cce5ff;
            color: #004085;
        }
        
        .decorative-border {
            width: 80px;
            height: 2px;
            background: linear-gradient(45deg, #d4af37, #f4e4a6);
            margin: 0 auto 1rem auto;
            border-radius: 2px;
        }
        
        @media (max-width: 768px) {
            .reports-title {
                font-size: 2rem;
            }
            
            .reports-header {
                padding: 80px 0 30px 0;
            }
            
            .stats-card {
                padding: 20px;
                margin-bottom: 15px;
            }
            
            .stats-value {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg fixed-top" style="background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(10px); z-index: 1000; min-height: 60px; padding: 0.5rem 0;">
        <div class="container d-flex align-items-center justify-content-between flex-nowrap">
            <a class="navbar-brand" href="{% url 'BridesOfSaima:homepage' %}" style="color: #d4af37; font-family: 'Dancing Script', cursive; font-size: 1.6rem; font-weight: 700; margin: 0; white-space: nowrap;">
                Brides of Saima
            </a>
            
            <div class="navbar-nav d-flex align-items-center flex-row flex-nowrap">
                <!-- Back to Home Button -->
                <a href="{% url 'BridesOfSaima:homepage' %}" class="btn btn-outline-light btn-sm me-2" style="color: #d4af37; border-color: #d4af37; padding: 5px 12px; font-size: 0.8rem;" title="Back to Home">
                    ‚Üê Home
                </a>
                
                <!-- Admin Icon -->
                {% if user.is_authenticated %}
                    <div class="dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" style="color: #d4af37; font-size: 1.2rem; padding: 5px;">
                            {% if user.is_staff %}
                                üëë
                            {% else %}
                                üë§
                            {% endif %}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" style="background: rgba(0, 0, 0, 0.9); border: 1px solid #d4af37;">
                            <li>
                                <span class="dropdown-item-text" style="color: #d4af37; font-size: 0.9rem;">
                                    {{ user.username }}
                                    {% if user.is_staff %}
                                        <small class="badge bg-warning text-dark ms-1">Admin</small>
                                    {% endif %}
                                </span>
                            </li>
                            <li><hr class="dropdown-divider" style="border-color: #d4af37;"></li>
                            {% if user.is_staff %}
                                <li>
                                    <a class="dropdown-item" href="/admin/" style="color: #fff; font-size: 0.9rem;" target="_blank">
                                        ‚öôÔ∏è Django Admin
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider" style="border-color: #d4af37;"></li>
                            {% endif %}
                            <li>
                                <form method="post" action="{% url 'logout' %}" style="margin: 0;">
                                    {% csrf_token %}
                                    <button type="submit" class="dropdown-item" style="color: #fff; background: none; border: none; font-size: 0.9rem;">
                                        üö™ Logout
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </div>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Reports Header -->
    <div class="reports-header">
        <div class="container">
            <h1 class="reports-title">{{ title }}</h1>
            <div class="decorative-border"></div>
            <p style="font-size: 1.1rem; margin-bottom: 0;">
                {% if selected_month and selected_year %}
                    {{ month_name }} {{ selected_year }} Report
                {% else %}
                    All Time Report
                {% endif %}
            </p>
        </div>
    </div>

    <!-- Reports Content -->
    <div class="container py-5">
        <!-- Filter Section -->
        <div class="filter-card">
            <h5 style="color: #d4af37; font-family: 'Dancing Script', cursive; font-size: 1.5rem; margin-bottom: 1rem;">üìä Filter Reports</h5>
            <form method="get" class="row align-items-end">
                <div class="col-md-4 mb-3">
                    <label class="form-label fw-bold">Month</label>
                    <select name="month" class="form-select">
                        <option value="">All Months</option>
                        {% for month_num, month_name in months %}
                            <option value="{{ month_num }}" {% if selected_month == month_num %}selected{% endif %}>
                                {{ month_name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label fw-bold">Year</label>
                    <select name="year" class="form-select">
                        <option value="">All Years</option>
                        {% for year in years %}
                            <option value="{{ year }}" {% if selected_year == year %}selected{% endif %}>
                                {{ year }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <button type="submit" class="btn btn-filter w-100">üîç Apply Filter</button>
                </div>
            </form>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-lg-3 col-md-6">
                <div class="stats-card">
                    <div class="stats-icon">üìÖ</div>
                    <div class="stats-value">{{ total_bookings }}</div>
                    <div class="stats-label">Total Bookings</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="stats-card">
                    <div class="stats-icon">üí∞</div>
                    <div class="stats-value">‚Çπ{{ total_revenue|floatformat:0 }}</div>
                    <div class="stats-label">Total Revenue</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="stats-card">
                    <div class="stats-icon">üí≥</div>
                    <div class="stats-value">‚Çπ{{ total_advance|floatformat:0 }}</div>
                    <div class="stats-label">Total Advance</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="stats-card">
                    <div class="stats-icon">‚è≥</div>
                    <div class="stats-value">‚Çπ{{ total_due|floatformat:0 }}</div>
                    <div class="stats-label">Total Due</div>
                </div>
            </div>
        </div>

        <!-- Payment Status Breakdown -->
        <div class="row mb-4">
            <div class="col-lg-4 col-md-4">
                <div class="stats-card">
                    <div class="stats-icon">‚úÖ</div>
                    <div class="stats-value">{{ paid_invoices }}</div>
                    <div class="stats-label">Paid Invoices</div>
                </div>
            </div>
            <div class="col-lg-4 col-md-4">
                <div class="stats-card">
                    <div class="stats-icon">‚è∞</div>
                    <div class="stats-value">{{ pending_invoices }}</div>
                    <div class="stats-label">Pending Invoices</div>
                </div>
            </div>
            <div class="col-lg-4 col-md-4">
                <div class="stats-card">
                    <div class="stats-icon">üîÑ</div>
                    <div class="stats-value">{{ partial_invoices }}</div>
                    <div class="stats-label">Partial Invoices</div>
                </div>
            </div>
        </div>

        <!-- Monthly Chart -->
        <div class="chart-card mb-4">
            <h5 style="color: #d4af37; font-family: 'Dancing Script', cursive; font-size: 1.5rem; margin-bottom: 1rem;">üìà Monthly Revenue Trend</h5>
            <canvas id="monthlyChart" width="400" height="200"></canvas>
        </div>

        <!-- Recent Invoices Table -->
        <div class="invoice-table">
            <div class="p-3">
                <h5 style="color: #d4af37; font-family: 'Dancing Script', cursive; font-size: 1.5rem; margin-bottom: 1rem;">üìã Invoice Details</h5>
            </div>
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Invoice #</th>
                            <th>Customer</th>
                            <th>Due Date</th>
                            <th>Amount</th>
                            <th>Advance</th>
                            <th>Due</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for invoice in invoices %}
                            <tr>
                                <td>
                                    <a href="{% url 'BridesOfSaima:invoice_detail' invoice.pk %}" style="color: #d4af37; text-decoration: none;">
                                        {{ invoice.invoice_number }}
                                    </a>
                                </td>
                                <td>{{ invoice.customer.name }}</td>
                                <td>{{ invoice.due_date|date:"M d, Y" }}</td>
                                <td>‚Çπ{{ invoice.total_amount|floatformat:0 }}</td>
                                <td>‚Çπ{{ invoice.advance_amount|floatformat:0 }}</td>
                                <td>‚Çπ{{ invoice.due_amount|floatformat:0 }}</td>
                                <td>
                                    <span class="payment-status status-{{ invoice.payment_status }}">
                                        {% if invoice.payment_status == 'paid' %}‚úÖ Paid
                                        {% elif invoice.payment_status == 'pending' %}‚è∞ Pending
                                        {% elif invoice.payment_status == 'partial' %}üîÑ Partial
                                        {% endif %}
                                    </span>
                                </td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="7" class="text-center text-muted py-4">
                                    No invoices found for the selected period.
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Monthly Revenue Chart
        const ctx = document.getElementById('monthlyChart').getContext('2d');
        const monthlyData = {{ monthly_data|safe }};
        
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: monthlyData.map(item => `${item.month.substring(0,3)} ${item.year}`),
                datasets: [{
                    label: 'Revenue (‚Çπ)',
                    data: monthlyData.map(item => item.revenue),
                    borderColor: '#d4af37',
                    backgroundColor: 'rgba(212, 175, 55, 0.1)',
                    tension: 0.4,
                    fill: true
                }, {
                    label: 'Bookings',
                    data: monthlyData.map(item => item.bookings),
                    borderColor: '#b8941f',
                    backgroundColor: 'rgba(184, 148, 31, 0.1)',
                    tension: 0.4,
                    yAxisID: 'y1'
                }]
            },
            options: {
                responsive: true,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: {
                            display: true,
                            text: 'Revenue (‚Çπ)'
                        }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: {
                            display: true,
                            text: 'Bookings'
                        },
                        grid: {
                            drawOnChartArea: false,
                        },
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                }
            }
        });
    </script>
</body>
</html>